pipeline{
    agent{
        docker {
            image  'python:3.11-slim'
            args    '-u root'
        }
    }
    stages{
        stage("checkout-code"){
            steps{
                checkout scm
            
            }
        }
        stage("install dependencies"){
            steps{
                sh 'ls -lart'
                sh 'cd python-api-yt'
                sh 'pip install -r requirements.txt'
            }
        }
        stage("run the test"){
            steps{
                sh "pytest --junitxml=results.xml || true"
            }
        }
        stage("archive results"){
            steps{
                junit 'result.xml'
            }
        }
    }
    post{
        success{
            echo "Build and test passed"
        }
        failure{
            echo "Build test failed"
        }
    }

}
